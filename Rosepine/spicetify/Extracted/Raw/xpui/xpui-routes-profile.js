"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[2499],{75e3:(e,a,i)=>{i.d(a,{P:()=>g});var t=i(59496),r=i(72481),o=i(30099),s=i(70231),l=i(14090),n=i(85259),d=i(25462),u=i(31101),c=i(18858),m=i(4637);const g=t.memo((function(e){const{images:a,name:i,uri:g,onClick:p,isHero:h,testId:v,index:f,requestId:x,color:b}=e;let y;const k=(0,t.useCallback)((()=>(0,m.jsx)(n.x,{isCircular:!0,isHero:h,images:a,color:b,FallbackComponent:e=>(0,m.jsx)(r.a,{iconSize:64,...e})})),[b,a,h]),j=(0,t.useCallback)((()=>h?(0,m.jsx)(u.k,{children:o.ag.get("card.tag.profile")}):o.ag.get("card.tag.profile")),[h]);return y=h?(0,m.jsx)(d.Z,{index:f,onClick:p,headerText:i,featureIdentifier:"profile",uri:g,isPlayable:!1,renderCardImage:k,renderSubHeaderContent:j,testId:v,requestId:x}):(0,m.jsx)(l.C,{index:f,onClick:p,headerText:i,featureIdentifier:"profile",uri:g,isPlayable:!1,renderCardImage:k,renderSubHeaderContent:j,testId:v,requestId:x}),(0,m.jsx)(s._,{menu:(0,m.jsx)(c.I,{uri:g}),children:y})}))},96422:(e,a,i)=>{i.d(a,{T:()=>c});var t=i(90784),r=i(72843),o=i(88354),s=i(12640),l=i(7018);const n="profile-editImage-imageContainer",d="profile-editImage-editImageButtonContainer";var u=i(4637);const c=function({onClick:e,name:a,images:i,canEdit:c,placeholderType:m,shape:g=l.Kc.SQUARE,dragUri:p=""}){const[h,v]=(0,r.R)(i),f=(0,o.VO)(h,v)===o.KO.loaded,x=(0,t.O)([p],a);return(0,u.jsxs)("div",{className:n,"data-testid":`${m}-image`,draggable:!!p,onDragStart:x,children:[(0,u.jsx)(l.Oe,{loading:"eager",name:a,images:i,placeholderType:m,shape:g}),c&&(0,u.jsx)("div",{className:d,children:(0,u.jsx)(s.F,{overlay:f,onClick:e,rounded:g===l.Kc.CIRCLE})})]})}},39815:(e,a,i)=>{i.d(a,{k:()=>d});var t=i(84875),r=i.n(t),o=i(9990),s=i(17237),l=i(47948),n=i(4637);const d=({children:e})=>{const a=(0,o.W6)(l.vyX,{loadingValue:!1});return(0,n.jsx)("div",{className:r()(s.Z.imageContainer,{[s.Z.imageContainerNew]:a}),children:e})}},54985:(e,a,i)=>{i.d(a,{g:()=>s});var t=i(51697),r=i(17237),o=i(4637);const s=({children:e})=>(0,o.jsx)(t.D,{variant:"mesto",className:r.Z.pretitle,children:e})},71400:(e,a,i)=>{i.r(a),i.d(a,{default:()=>Oa});var t=i(59496),r=i(97601),o=i(70356),s=i(14887),l=i(84875),n=i.n(l),d=i(30099),u=i(75e3),c=i(75132),m=i(854),g=i(10896),p=i(70326);const h="profile-userOverview-container",v="profile-userOverview-section",f="profile-userOverview-subPage",x="profile-userOverview-topTrackSubPage",b="profile-userOverview-title",y="profile-userOverview-header";var k=i(4637);const j=e=>{const{uri:a}=e,{data:i,loading:t,error:r}=(0,g.J)(p.n5.getFollowers,[a]),o=i?.profiles;return t?(0,k.jsx)(c.h,{hasError:null!==r,errorMessage:d.ag.get("error.not_found.title.page")}):(0,k.jsx)(m.P,{className:n()("contentSpacing",f),title:d.ag.get("followers"),total:o?.length,showAll:!0,children:o?.map(((e,a)=>(0,k.jsx)(u.P,{index:a,uri:e.uri,name:e.name,images:[{url:e.image_url}]},e.uri)))})},I=e=>{const{uri:a}=e,{data:i,loading:t,error:r}=(0,g.J)(p.n5.getFollowing,[a]),o=i?.profiles;return t?(0,k.jsx)(c.h,{hasError:null!==r,errorMessage:d.ag.get("error.not_found.title.page")}):(0,k.jsx)(m.P,{className:n()("contentSpacing",f),title:d.ag.get("following"),total:o?.length,showAll:!0,children:o?.map(((e,a)=>(0,k.jsx)(u.P,{index:a,uri:e.uri,name:e.name,images:[{url:e.image_url}]},e.uri)))})};var _=i(83792),N=i(23055),w=i(70300),P=i(53778),S=i(78384),C=i(18858),R=i(70304),T=i(96422),O=i(7018),A=i(20456),D=i(29915),U=i(51697),E=i(9401),M=i(49876),F=i(98484),L=i(89605),W=i(72843),H=i(88354);const J="profile-userEditDetails-image",K="valcBm4lLe9qFBcg0sFY",B="tAIzXn8C9KriGwGuBfWg",Q="PsrXxenHUFXYM1ub1xWw",Z="U_VWfeeLWnDPhUTxCmrQ",G=function({onClickEdit:e,onClickRemove:a,name:i,images:t}){const[r,o]=(0,W.R)(t),s=(0,H.VO)(r,o)===H.KO.loaded;return(0,k.jsxs)("div",{className:J,children:[(0,k.jsx)(O.Oe,{loading:"eager",name:i,images:t,placeholderType:"user",shape:O.Kc.CIRCLE}),(0,k.jsxs)("div",{className:n()(K,{[Q]:s}),children:[(0,k.jsx)("button",{className:B,"aria-haspopup":"true",onClick:e,type:"button",children:(0,k.jsx)(U.D,{variant:"ballad",children:d.ag.get("user.edit-details.choose-photo")})}),(0,k.jsx)("div",{className:n()(Z,"icon"),children:(0,k.jsx)(L.y,{iconSize:48,"aria-hidden":!0})}),(0,k.jsx)("button",{className:B,onClick:a,type:"button",children:(0,k.jsx)(U.D,{variant:"ballad",children:d.ag.get("user.edit-details.remove-photo")})})]})]})};var V=i(74021),z=i(91646),q=i(60044);const X={paths:""},Y={encode(e,a=q.Writer.create()){for(const i of e.paths)a.uint32(10).string(i);return a},decode(e,a){const i=e instanceof Uint8Array?new q.Reader(e):e;let t=void 0===a?i.len:i.pos+a;const r={...X};for(r.paths=[];i.pos<t;){const e=i.uint32();if(e>>>3==1)r.paths.push(i.string());else i.skipType(7&e)}return r},fromJSON(e){const a={...X};if(a.paths=[],void 0!==e.paths&&null!==e.paths)for(const i of e.paths)a.paths.push(String(i));return a},fromPartial(e){const a={...X};if(a.paths=[],void 0!==e.paths&&null!==e.paths)for(const i of e.paths)a.paths.push(i);return a},toJSON(e){const a={};return e.paths?a.paths=e.paths.map((e=>e)):a.paths=[],a}};i(27348);var $=i(3959),ee=i(55872).lW;const ae={value:0},ie={value:!1},te={value:""};const re={encode:(e,a=q.Writer.create())=>(a.uint32(8).int32(e.value),a),decode(e,a){const i=e instanceof Uint8Array?new q.Reader(e):e;let t=void 0===a?i.len:i.pos+a;const r={...ae};for(;i.pos<t;){const e=i.uint32();if(e>>>3==1)r.value=i.int32();else i.skipType(7&e)}return r},fromJSON(e){const a={...ae};return void 0!==e.value&&null!==e.value?a.value=Number(e.value):a.value=0,a},fromPartial(e){const a={...ae};return void 0!==e.value&&null!==e.value?a.value=e.value:a.value=0,a},toJSON(e){const a={};return void 0!==e.value&&(a.value=e.value),a}},oe={encode:(e,a=q.Writer.create())=>(a.uint32(8).bool(e.value),a),decode(e,a){const i=e instanceof Uint8Array?new q.Reader(e):e;let t=void 0===a?i.len:i.pos+a;const r={...ie};for(;i.pos<t;){const e=i.uint32();if(e>>>3==1)r.value=i.bool();else i.skipType(7&e)}return r},fromJSON(e){const a={...ie};return void 0!==e.value&&null!==e.value?a.value=Boolean(e.value):a.value=!1,a},fromPartial(e){const a={...ie};return void 0!==e.value&&null!==e.value?a.value=e.value:a.value=!1,a},toJSON(e){const a={};return void 0!==e.value&&(a.value=e.value),a}},se={encode:(e,a=q.Writer.create())=>(a.uint32(10).string(e.value),a),decode(e,a){const i=e instanceof Uint8Array?new q.Reader(e):e;let t=void 0===a?i.len:i.pos+a;const r={...te};for(;i.pos<t;){const e=i.uint32();if(e>>>3==1)r.value=i.string();else i.skipType(7&e)}return r},fromJSON(e){const a={...te};return void 0!==e.value&&null!==e.value?a.value=String(e.value):a.value="",a},fromPartial(e){const a={...te};return void 0!==e.value&&null!==e.value?a.value=e.value:a.value="",a},toJSON(e){const a={};return void 0!==e.value&&(a.value=e.value),a}};q.util.Long!==$.Z&&(q.util.Long=$.Z,(0,q.configure)());const le=globalThis;le.atob,le.btoa;const ne={maxWidth:0,maxHeight:0,url:""},de={},ue={},ce={encode:(e,a=q.Writer.create())=>(a.uint32(8).int32(e.maxWidth),a.uint32(16).int32(e.maxHeight),a.uint32(26).string(e.url),a),decode(e,a){const i=e instanceof Uint8Array?new q.Reader(e):e;let t=void 0===a?i.len:i.pos+a;const r={...ne};for(;i.pos<t;){const e=i.uint32();switch(e>>>3){case 1:r.maxWidth=i.int32();break;case 2:r.maxHeight=i.int32();break;case 3:r.url=i.string();break;default:i.skipType(7&e)}}return r},fromJSON(e){const a={...ne};return void 0!==e.maxWidth&&null!==e.maxWidth?a.maxWidth=Number(e.maxWidth):a.maxWidth=0,void 0!==e.maxHeight&&null!==e.maxHeight?a.maxHeight=Number(e.maxHeight):a.maxHeight=0,void 0!==e.url&&null!==e.url?a.url=String(e.url):a.url="",a},fromPartial(e){const a={...ne};return void 0!==e.maxWidth&&null!==e.maxWidth?a.maxWidth=e.maxWidth:a.maxWidth=0,void 0!==e.maxHeight&&null!==e.maxHeight?a.maxHeight=e.maxHeight:a.maxHeight=0,void 0!==e.url&&null!==e.url?a.url=e.url:a.url="",a},toJSON(e){const a={};return void 0!==e.maxWidth&&(a.maxWidth=e.maxWidth),void 0!==e.maxHeight&&(a.maxHeight=e.maxHeight),void 0!==e.url&&(a.url=e.url),a}},me={encode(e,a=q.Writer.create()){void 0!==e.username&&void 0!==e.username&&se.encode({value:e.username},a.uint32(10).fork()).ldelim(),void 0!==e.name&&void 0!==e.name&&se.encode({value:e.name},a.uint32(18).fork()).ldelim();for(const i of e.images)ce.encode(i,a.uint32(26).fork()).ldelim();return void 0!==e.verified&&void 0!==e.verified&&oe.encode({value:e.verified},a.uint32(34).fork()).ldelim(),void 0!==e.editProfileDisabled&&void 0!==e.editProfileDisabled&&oe.encode({value:e.editProfileDisabled},a.uint32(42).fork()).ldelim(),void 0!==e.reportAbuseDisabled&&void 0!==e.reportAbuseDisabled&&oe.encode({value:e.reportAbuseDisabled},a.uint32(50).fork()).ldelim(),void 0!==e.abuseReportedName&&void 0!==e.abuseReportedName&&oe.encode({value:e.abuseReportedName},a.uint32(58).fork()).ldelim(),void 0!==e.abuseReportedImage&&void 0!==e.abuseReportedImage&&oe.encode({value:e.abuseReportedImage},a.uint32(66).fork()).ldelim(),void 0!==e.hasSpotifyName&&void 0!==e.hasSpotifyName&&oe.encode({value:e.hasSpotifyName},a.uint32(74).fork()).ldelim(),void 0!==e.hasSpotifyImage&&void 0!==e.hasSpotifyImage&&oe.encode({value:e.hasSpotifyImage},a.uint32(82).fork()).ldelim(),void 0!==e.color&&void 0!==e.color&&re.encode({value:e.color},a.uint32(90).fork()).ldelim(),a},decode(e,a){const i=e instanceof Uint8Array?new q.Reader(e):e;let t=void 0===a?i.len:i.pos+a;const r={...de};for(r.images=[];i.pos<t;){const e=i.uint32();switch(e>>>3){case 1:r.username=se.decode(i,i.uint32()).value;break;case 2:r.name=se.decode(i,i.uint32()).value;break;case 3:r.images.push(ce.decode(i,i.uint32()));break;case 4:r.verified=oe.decode(i,i.uint32()).value;break;case 5:r.editProfileDisabled=oe.decode(i,i.uint32()).value;break;case 6:r.reportAbuseDisabled=oe.decode(i,i.uint32()).value;break;case 7:r.abuseReportedName=oe.decode(i,i.uint32()).value;break;case 8:r.abuseReportedImage=oe.decode(i,i.uint32()).value;break;case 9:r.hasSpotifyName=oe.decode(i,i.uint32()).value;break;case 10:r.hasSpotifyImage=oe.decode(i,i.uint32()).value;break;case 11:r.color=re.decode(i,i.uint32()).value;break;default:i.skipType(7&e)}}return r},fromJSON(e){const a={...de};if(a.images=[],void 0!==e.username&&null!==e.username?a.username=String(e.username):a.username=void 0,void 0!==e.name&&null!==e.name?a.name=String(e.name):a.name=void 0,void 0!==e.images&&null!==e.images)for(const i of e.images)a.images.push(ce.fromJSON(i));return void 0!==e.verified&&null!==e.verified?a.verified=Boolean(e.verified):a.verified=void 0,void 0!==e.editProfileDisabled&&null!==e.editProfileDisabled?a.editProfileDisabled=Boolean(e.editProfileDisabled):a.editProfileDisabled=void 0,void 0!==e.reportAbuseDisabled&&null!==e.reportAbuseDisabled?a.reportAbuseDisabled=Boolean(e.reportAbuseDisabled):a.reportAbuseDisabled=void 0,void 0!==e.abuseReportedName&&null!==e.abuseReportedName?a.abuseReportedName=Boolean(e.abuseReportedName):a.abuseReportedName=void 0,void 0!==e.abuseReportedImage&&null!==e.abuseReportedImage?a.abuseReportedImage=Boolean(e.abuseReportedImage):a.abuseReportedImage=void 0,void 0!==e.hasSpotifyName&&null!==e.hasSpotifyName?a.hasSpotifyName=Boolean(e.hasSpotifyName):a.hasSpotifyName=void 0,void 0!==e.hasSpotifyImage&&null!==e.hasSpotifyImage?a.hasSpotifyImage=Boolean(e.hasSpotifyImage):a.hasSpotifyImage=void 0,void 0!==e.color&&null!==e.color?a.color=Number(e.color):a.color=void 0,a},fromPartial(e){const a={...de};if(a.images=[],void 0!==e.username&&null!==e.username?a.username=e.username:a.username=void 0,void 0!==e.name&&null!==e.name?a.name=e.name:a.name=void 0,void 0!==e.images&&null!==e.images)for(const i of e.images)a.images.push(ce.fromPartial(i));return void 0!==e.verified&&null!==e.verified?a.verified=e.verified:a.verified=void 0,void 0!==e.editProfileDisabled&&null!==e.editProfileDisabled?a.editProfileDisabled=e.editProfileDisabled:a.editProfileDisabled=void 0,void 0!==e.reportAbuseDisabled&&null!==e.reportAbuseDisabled?a.reportAbuseDisabled=e.reportAbuseDisabled:a.reportAbuseDisabled=void 0,void 0!==e.abuseReportedName&&null!==e.abuseReportedName?a.abuseReportedName=e.abuseReportedName:a.abuseReportedName=void 0,void 0!==e.abuseReportedImage&&null!==e.abuseReportedImage?a.abuseReportedImage=e.abuseReportedImage:a.abuseReportedImage=void 0,void 0!==e.hasSpotifyName&&null!==e.hasSpotifyName?a.hasSpotifyName=e.hasSpotifyName:a.hasSpotifyName=void 0,void 0!==e.hasSpotifyImage&&null!==e.hasSpotifyImage?a.hasSpotifyImage=e.hasSpotifyImage:a.hasSpotifyImage=void 0,void 0!==e.color&&null!==e.color?a.color=e.color:a.color=void 0,a},toJSON(e){const a={};return void 0!==e.username&&(a.username=e.username),void 0!==e.name&&(a.name=e.name),e.images?a.images=e.images.map((e=>e?ce.toJSON(e):void 0)):a.images=[],void 0!==e.verified&&(a.verified=e.verified),void 0!==e.editProfileDisabled&&(a.editProfileDisabled=e.editProfileDisabled),void 0!==e.reportAbuseDisabled&&(a.reportAbuseDisabled=e.reportAbuseDisabled),void 0!==e.abuseReportedName&&(a.abuseReportedName=e.abuseReportedName),void 0!==e.abuseReportedImage&&(a.abuseReportedImage=e.abuseReportedImage),void 0!==e.hasSpotifyName&&(a.hasSpotifyName=e.hasSpotifyName),void 0!==e.hasSpotifyImage&&(a.hasSpotifyImage=e.hasSpotifyImage),void 0!==e.color&&(a.color=e.color),a}},ge={encode:(e,a=q.Writer.create())=>(void 0!==e.mask&&void 0!==e.mask&&Y.encode(e.mask,a.uint32(10).fork()).ldelim(),void 0!==e.userProfile&&void 0!==e.userProfile&&me.encode(e.userProfile,a.uint32(18).fork()).ldelim(),a),decode(e,a){const i=e instanceof Uint8Array?new q.Reader(e):e;let t=void 0===a?i.len:i.pos+a;const r={...ue};for(;i.pos<t;){const e=i.uint32();switch(e>>>3){case 1:r.mask=Y.decode(i,i.uint32());break;case 2:r.userProfile=me.decode(i,i.uint32());break;default:i.skipType(7&e)}}return r},fromJSON(e){const a={...ue};return void 0!==e.mask&&null!==e.mask?a.mask=Y.fromJSON(e.mask):a.mask=void 0,void 0!==e.userProfile&&null!==e.userProfile?a.userProfile=me.fromJSON(e.userProfile):a.userProfile=void 0,a},fromPartial(e){const a={...ue};return void 0!==e.mask&&null!==e.mask?a.mask=Y.fromPartial(e.mask):a.mask=void 0,void 0!==e.userProfile&&null!==e.userProfile?a.userProfile=me.fromPartial(e.userProfile):a.userProfile=void 0,a},toJSON(e){const a={};return void 0!==e.mask&&(a.mask=e.mask?Y.toJSON(e.mask):void 0),void 0!==e.userProfile&&(a.userProfile=e.userProfile?me.toJSON(e.userProfile):void 0),a}},pe=`${V.XA}/identity`;async function he(e,a,{name:i,imageUploadToken:t}){void 0!==i&&await async function(e,a,i){const t=ge.encode(ge.fromPartial({mask:{paths:["name"]},userProfile:null!==i?{name:i}:{}}));await e.build().withHost(pe).withMethod("POST").withPath(`/v3/user/username/${encodeURIComponent((0,z.C)(a))}`).withEndpointIdentifier("/v3/user/username/{username}").withBody(t.finish()).withoutMarket().send()}(e,a,i),void 0!==t&&(null!==t?await async function(e,a,i){await e.build().withHost(pe).withMethod("POST").withPath(`/v3/profile-image/${encodeURIComponent((0,z.C)(a))}/${i}`).withEndpointIdentifier("/v3/profile-image/{username}/{uploadToken}").withoutMarket().send()}(e,a,t):await async function(e,a){await e.build().withHost(pe).withMethod("DELETE").withPath(`/v3/profile-image/${encodeURIComponent((0,z.C)(a))}`).withEndpointIdentifier("/v3/profile-image/{username}").withoutMarket().send()}(e,a))}var ve=i(90326);const fe={type:"error",get message(){return d.ag.get("user.edit-details.error.file-size-exceeded",10)}},xe={type:"error",get message(){return d.ag.get("user.edit-details.error.too-small",300,300)}},be={type:"error",get message(){return d.ag.get("user.edit-details.error.missing-name")}},ye={type:"error",get message(){return d.ag.get("user.edit-details.error.failed-to-save")}},ke={type:"error",get message(){return d.ag.get("user.edit-details.error.file-upload-failed")}};function je(e){return{type:"setLoading",loading:e}}function Ie(e){return{type:"setMessage",message:e}}function _e(e,a){switch(a.type){case"setName":return{...e,name:a.name};case"setMessage":return{...e,message:a.message,loading:!1};case"setLoading":return{...e,loading:a.loading,message:null};case"setImageData":return{...e,imageData:a.data,removeImage:!1};case"setImageToken":return{...e,imageToken:a.token,removeImage:!1};case"removeImage":return{...e,imageToken:void 0,imageData:void 0,image:void 0,removeImage:!0};default:return e}}var Ne=i(1541),we=i(32904),Pe=i(47978);const Se="XwNfIrI6_hCa_9_T2cQB",Ce="so0bdX3oZH6YW5_nGxIR",Re="aM3plU4zzDqjWlvUHGYb",Te="zHeo4VUxytwm6Ptr0QyA",Oe="vAeyAmeLkDEDKdL9Hou0",Ae="dnmzO6yYKkxUV8jl7O1Z",De="oN9QVvJKEtdTH3HGfCu1",Ue="uj7hczcCH1dZpse8Kfmi",Ee="wvLAEV5wF5C5ej6rvimT",Me="gAQfzAUp1FuSXODeZJfP",Fe="dMhJaxli87_22jb_3d9x",Le="MDb7QhAtHeyM4gKj8j8t",We="zGbjZMZ1DTx4futEbN9l",He=t.memo((function({uri:e,name:a,image:i,onClose:r,shouldOpenImagePicker:o}){const[s,l]=(0,we.Hs)(),[u,c]=function({name:e,image:a}){return(0,t.useReducer)(_e,{loading:!1,message:null,name:e,image:a})}({name:a,image:i}),m=(0,t.useMemo)((()=>{const e=u.imageData||u.image;return e?[{url:e,width:300,height:300}]:[]}),[u.image,u.imageData]);(0,t.useEffect)((()=>{o&&l()}),[l,o]);const g=(0,t.useCallback)((e=>{e===we.Hy.FILE_TOO_BIG?c(Ie(fe)):e===we.Hy.IMAGE_TOO_SMALL&&c(Ie(xe))}),[c]),p=(0,t.useCallback)((()=>{c({type:"removeImage"})}),[c]),h=(0,t.useCallback)((async a=>{a.preventDefault();if(0!==u.name.trim().length){c(je(!0));try{const a=u.removeImage?null:u.imageToken;await async function(e,{name:a,imageUploadToken:i}){await he(ve.b.getInstance(),e,{name:a,imageUploadToken:i})}(e,{name:u.name,imageUploadToken:a}),r({name:u.name,image:u.imageData||u.image})}catch(e){c(Ie(ye))}}else c(Ie(be))}),[c,r,u.image,u.imageData,u.imageToken,u.name,u.removeImage,e]);return(0,k.jsx)(Ne.Z,{isOpen:!0,contentLabel:d.ag.get("user.edit-details.title"),onRequestClose:()=>r(),children:(0,k.jsxs)("div",{className:Se,children:[(0,k.jsxs)("div",{className:Re,children:[(0,k.jsx)(U.D,{as:"h1",variant:"canon",children:d.ag.get("user.edit-details.title")}),(0,k.jsx)("button",{className:Te,onClick:()=>r(),"aria-label":d.ag.get("close"),children:(0,k.jsx)(E.k,{iconSize:16})})]}),u.message&&(0,k.jsx)(Pe.X,{isErrorMessage:"error"===u.message.type,message:u.message.message}),(0,k.jsxs)("form",{className:Ce,onSubmit:h,children:[(0,k.jsx)(we.uL,{isOpen:s,minImageWidth:300,minImageHeight:300,maxFileSizeMB:10,onChange:async function(e){if(!e)return;const{imageFile:a,imageDataUrl:i}=e;if(c(Ie(null)),c({type:"setImageData",data:i}),a)try{c(je(!0));const e=await async function(e){const a=await ve.b.getInstance().build().withEndpointIdentifier("image-upload/v4/user-profile").withHost("https://image-upload.spotify.com/v4").withMethod("POST").withPath("/user-profile").withBody(e).withoutGlobalHeaders().withHeaders([{key:"Content-Type",value:"image/jpeg"}]).withoutMarket().send();if(!a.body)throw new Error("No upload token recieved");return a.body.uploadToken}(a);c({type:"setImageToken",token:e}),c(je(!1))}catch{c(Ie(ke))}},onError:g}),(0,k.jsxs)("div",{className:Oe,children:[(0,k.jsx)(G,{name:a,images:m,onClickEdit:l,onClickRemove:p}),u.loading&&(0,k.jsx)("div",{className:Ae,children:(0,k.jsx)(M.T,{})})]}),(0,k.jsxs)("div",{className:Ue,children:[(0,k.jsx)("label",{htmlFor:"user-edit-name",className:Ee,children:(0,k.jsx)(U.D,{variant:"finaleBold",className:Me,children:d.ag.get("user.edit-details.name-label")})}),(0,k.jsx)("input",{"data-testid":"user-edit-name-input",id:"user-edit-name",type:"text",dir:"auto",className:n()(De,Fe),onChange:e=>{c(function(e){return{type:"setName",name:e}}(e.target.value))},placeholder:d.ag.get("user.edit-details.name-placeholder"),maxLength:32,value:u.name})]}),(0,k.jsx)("div",{className:Le,children:(0,k.jsx)(F.D,{colorSet:"invertedLight",onClick:h,disabled:u.loading,children:d.ag.get("save")})}),(0,k.jsx)(U.D,{as:"p",variant:"finaleBold",className:We,children:d.ag.get("image-upload.legal-disclaimer")})]})]})})}));var Je=i(95195);var Ke=i(35960),Be=i(4229),Qe=i(60168),Ze=i(7554),Ge=i(50450),Ve=i(70231),ze=i(34046),qe=i(34997),Xe=i(51862),Ye=i(46927),$e=i(40006),ea=i(33735),aa=i(31269),ia=i(18112),ta=i(7442),ra=i(90154),oa=i(68985),sa=i(26473);const la=t.memo((function({openModal:e,spec:a,logger:i,name:r,backgroundColor:o,isCurrentUser:s,uri:l}){const[n,u]=(0,ra.H)(l),c=(0,ia.o)(),m=!(0,ta.k)(),g=(0,t.useCallback)((()=>{c({targetUri:l,intent:n?"unfollow":"follow",type:"click"});const e=a.actionBarFactory().followButtonFactory();n?(u(!1),i.logInteraction(e.hitUnfollow({itemToBeUnfollowed:l}))):(u(!0),i.logInteraction(e.hitFollow({itemToBeFollowed:l})))}),[n,i,c,u,a,l]),p=(0,t.useCallback)((()=>{const e=a.actionBarFactory().contextMenuButtonFactory().hitUiReveal();i.logInteraction(e)}),[i,a]),h=(0,sa.j)();return(0,k.jsx)(Ye.o,{backgroundColor:o,children:(0,k.jsxs)(Ye.F,{children:[!s&&(0,k.jsx)(ea.r,{children:(0,k.jsx)(aa.e,{isFollowing:Boolean(n),onClick:g,disabled:m})}),(0,k.jsx)(oa.y,{menu:(0,k.jsx)(C.I,{uri:l,onEditProfileCallback:e}),children:(0,k.jsx)($e.MoreButton,{label:d.ag.get("more.label.context",r),onClick:p,size:h})})]})})}));var na=i(59070),da=i(36342),ua=i(33257),ca=i(97428),ma=i(15644),ga=i(13138);const pa=t.memo((function({tracks:e,hasHeaderRow:a=!1,nrTracksVisible:i,uri:r}){const o=(0,z.C)(r),l=(0,s.qC)(o,"tracks").toURI(),n=(0,t.useMemo)((()=>i?e.slice(0,i):e),[i,e]),{usePlayContextItem:u}=(0,ga.n)({uri:l,pages:[{items:e.map((e=>({type:Je.p.TRACK,uri:e.uri,uid:null,provider:null})))}]},{featureIdentifier:"profile",referrerIdentifier:"user_profile"}),c=(0,t.useCallback)(((e,a)=>{const i=(0,qe.X)(e?.album?.images,{desiredSize:40});return(0,k.jsx)(ua.SS,{index:a,uri:(0,ca.$)(e),duration_ms:e.duration_ms,name:e.name,artists:e.artists,album:e.album,isPlayable:!0,isExplicit:!!e.explicit,isMOGEFRestricted:!!e.mogef19,imgUrl:i?.url||"",contextUri:l,usePlayContextItem:u},a+e.uri)}),[l,u]),m=(0,t.useMemo)((()=>[da.QD.INDEX,da.QD.TITLE,da.QD.ALBUM,da.QD.DURATION]),[]),g=(0,t.useCallback)((e=>e.uri),[]);return(0,k.jsx)(ma.ZP,{value:"user-top-tracks-tracklist",children:(0,k.jsx)(da.Pv,{ariaLabel:d.ag.get("top_tracks_this_month"),renderRow:c,nrTracks:n.length,tracks:n,resolveUri:g,hasHeaderRow:a,columns:m})})}),((e,a)=>e.tracks===a.tracks)),ha=t.memo((function({tracks:e,title:a,tagline:i,seeAllUri:r,className:o,uri:s,spec:l}){const n=(0,ze.$P)(),d=(0,t.useCallback)((()=>{const e=l.titleLinkFactory().hitUiNavigate({destination:r});n.logInteraction(e)}),[n,r,l]),u=(0,t.useCallback)((()=>{const e=l.titleLinkFactory().hitUiNavigate({destination:r});n.logInteraction(e)}),[n,r,l]);if(!e||0===e.length)return null;const c=e.length>4;return(0,k.jsxs)("section",{className:o,children:[(0,k.jsx)(na.r,{title:a,tagline:i,seeAllUri:r,hasMoreElements:c,onClickTitle:d,onClickSeeAll:u}),(0,k.jsx)(ze.Nh,{spec:l,children:(0,k.jsx)(pa,{tracks:e,uri:s,nrTracksVisible:4})})]})}),((e,a)=>e.tracks===a.tracks));function va(e,a){switch(a.type){case"OPEN_MODAL":return{isModalOpen:!0,modalVariant:"editProfile",shouldOpenImagePicker:!1};case"OPEN_MODAL_WITH_IMAGEPICKER":return{isModalOpen:!0,modalVariant:"editProfile",shouldOpenImagePicker:!0};case"CLOSE_MODAL":return{isModalOpen:!1,modalVariant:null,shouldOpenImagePicker:!1};default:return e}}var fa=i(39815),xa=i(54985),ba=i(51742),ya=i(12463);const ka=18e5,ja=3e5,Ia=(0,N.P1)(Ze.dy,(e=>e?.images||[])),_a=({uri:e})=>{const a=(0,_.v9)(Ze.Gf),i=(0,_.v9)(Ia),r=(0,_.I0)(),o=(0,t.useMemo)((()=>(0,qe.X)(i)),[i]),[{isModalOpen:l,modalVariant:m,shouldOpenImagePicker:f},x]=function(){const[e,a]=(0,t.useReducer)(va,{isModalOpen:!1,modalVariant:null,shouldOpenImagePicker:!1});return[e,a]}(),b=(0,Ke.g)(),y=(()=>{const e=(0,_.v9)((e=>e.session?.user));return e?{type:Je.p.USER,uri:e.uri,username:e.id,displayName:e.display_name??null,images:e.images.map((({url:e,width:a,height:i})=>({url:e,width:a||void 0,height:i||void 0}))),optInTrialPremiumOnlyMarket:Boolean(e.policies?.opt_in_trial_premium_only_market)}:null})()?.uri,{data:j,loading:I}=(0,g.J)(p.n5.getProfile,[{uri:e,playlists:10,artists:10,episodes:10}],{cacheTime:ka,staleTime:ja}),N=j?.public_playlists,U=j?.is_verified,E=!!y&&(0,s.U4)(e,y),M=j?.recently_played_artists,F=E?o?.url||"":j?.image_url||"",L=(0,z.C)(e),W=(0,_.v9)(Qe.C7),H=(E?a:j?.name)||"",J=(0,Be.Z)(j?.image_url||null),{spec:K,logger:B}=(0,ze.fU)(w.L,{data:{uri:e}}),Q=(0,t.useMemo)((()=>K.sectionTopTracksFactory()),[K]),Z=!b&&(!1!==j?.show_follows||E),{data:G,loading:V}=(0,g.J)(p.n5.getFollowing,[e],{enabled:Z,cacheTime:ka,staleTime:ja}),q=G?.profiles,{data:X,loading:Y}=(0,g.J)(p.n5.getFollowers,[e],{enabled:Z,cacheTime:ka,staleTime:ja}),$=X?.profiles,{data:ee,loading:ae}=(0,g.J)(p.n5.getUserTopArtists,[],{enabled:E,cacheTime:ka,staleTime:ja}),{data:ie,loading:te}=(0,g.J)(p.n5.getUserTopTracks,[],{enabled:E&&!W,cacheTime:ka,staleTime:ja}),re=ee?.body,oe=ie?.body,se=(0,t.useCallback)((e=>{x({type:"CLOSE_MODAL"}),e&&(r((0,Ge.dL)(e.name)),r((0,Ge.GR)(e.image?[{url:e.image,height:null,width:null}]:[])))}),[x,r]),le=(0,t.useCallback)((()=>{x({type:"OPEN_MODAL"});const e=K.headerFactory().usernameFactory().hitUiReveal();B.logInteraction(e)}),[B,x,K]),ne=(0,t.useCallback)((()=>{x({type:"OPEN_MODAL_WITH_IMAGEPICKER"});const e=K.headerFactory().profileImageFactory().hitUiReveal();B.logInteraction(e)}),[B,x,K]),de=(0,t.useMemo)((()=>[{url:F}]),[F]),ue=(0,t.useCallback)((()=>{const e=K.headerFactory().usernameFactory().hitUiReveal();B.logInteraction(e)}),[B,K]),ce=(0,t.useCallback)(((e,a)=>{if(!a)return;const i=K.headerFactory().followersLinkFactory().hitUiNavigate({destination:a});B.logInteraction(i)}),[B,K]),me=(0,t.useCallback)(((e,a)=>{if(!a)return;const i=K.headerFactory().followersLinkFactory().hitUiNavigate({destination:a});B.logInteraction(i)}),[B,K]);if(!j||I||V||Y||te||ae)return(0,k.jsx)(c.h,{hasError:!1,errorMessage:d.ag.get("error.not_found.title.page")});const ge=n()("contentSpacing",v),pe=Z&&!!$?.length,he=Z&&!!q?.length;return(0,k.jsxs)("div",{className:h,children:[(0,k.jsx)(R.$,{children:H}),(0,k.jsxs)(O.gF,{backgroundColor:J,children:[(0,k.jsx)(A.W,{children:(0,k.jsx)(D.i,{text:H})}),(0,k.jsx)(Ve._,{menu:(0,k.jsx)(C.I,{uri:j.uri}),children:(0,k.jsx)(fa.k,{children:(0,k.jsx)(T.T,{canEdit:E,name:H,images:de,onClick:ne,placeholderType:"user",shape:O.Kc.CIRCLE})})}),(0,k.jsxs)(O.sP,{children:[(0,k.jsx)(xa.g,{children:U?(0,k.jsx)(ba.S,{text:d.ag.get("card.tag.profile")}):d.ag.get("card.tag.profile")}),(0,k.jsx)(Ve._,{menu:(0,k.jsx)(C.I,{uri:j.uri}),children:(0,k.jsx)(O.xd,{canEdit:E,editTitle:d.ag.get("playlist.edit-details.title"),onClick:le,children:H})}),(0,k.jsx)(O.QS,{totalFollowers:j.followers_count,totalFollowing:j.following_count,publicPlaylists:j.total_public_playlists_count,userUri:e,onCreatorClick:ue,onTotalFollowersClick:ce,onTotalFollowingClick:me})]})]}),(0,k.jsx)(la,{openModal:le,spec:K,logger:B,name:H,backgroundColor:J,isCurrentUser:E,uri:e}),(0,k.jsxs)(ze.Nh,{spec:K,children:[E&&(0,k.jsxs)(k.Fragment,{children:[!!re?.items.length&&(0,k.jsx)(ya.q,{className:ge,total:re?.total||0,title:d.ag.get("top_artists_this_month"),tagline:d.ag.get("only_visible_to_you"),seeAllUri:(0,s.QK)(L,["top","artists"]).toURI(),id:"top-artists",index:0,children:re.items.map(((e,a)=>(0,k.jsx)(P.I,{index:a,uri:e.uri,name:e.name,images:e.images},e.uri)))}),(0,k.jsx)(ha,{className:ge,title:d.ag.get("top_tracks_this_month"),tagline:d.ag.get("only_visible_to_you"),seeAllUri:(0,s.QK)(L,["top","tracks"]).toURI(),uri:e,tracks:oe?.items,spec:Q})]}),(0,k.jsx)(ya.q,{className:ge,total:j.total_public_playlists_count,title:d.ag.get("public_playlists"),seeAllUri:(0,s.QK)(L,["playlists"]).toURI(),id:"playlists",index:1,children:N?.map(((e,a)=>(0,k.jsx)(S.Z,{index:a,uri:e.uri,name:e.name,images:[{url:(0,Xe.p)({imageUriOrUrl:e.image_url}),width:300,height:300}],authorName:e.owner_name,description:e.followers_count?d.ag.get("user.followers",e.followers_count):""},e.uri)))}),M?.length?(0,k.jsx)(ya.q,{className:ge,total:M?.length,title:d.ag.get("recently_played_artists"),seeAllUri:(0,s.QK)(L,["recently-played-artists"]).toURI(),id:"recently-played-artists",index:2,children:M?.map(((e,a)=>(0,k.jsx)(P.I,{index:a,uri:e.uri,name:e.name,images:[{url:e.image_url}]},e.uri)))}):null,pe?(0,k.jsx)(ya.q,{className:ge,title:d.ag.get("followers"),total:$?.length,seeAllUri:(0,s.QK)(L,["followers"]).toURI(),id:"followers",index:3,children:$?.map(((e,a)=>(0,k.jsx)(u.P,{index:a,uri:e.uri,name:e.name,images:[{url:e.image_url}]},e.uri)))}):null,he?(0,k.jsx)(ya.q,{className:ge,title:d.ag.get("following"),total:q?.length,seeAllUri:(0,s.QK)(L,["following"]).toURI(),id:"following",index:4,children:q?.map(((e,a)=>(0,k.jsx)(u.P,{index:a,uri:e.uri,name:e.name,images:[{url:e.image_url}]},e.uri)))}):null,E&&l&&("editProfile"===m?(0,k.jsx)(He,{uri:e,name:H,image:F,onClose:se,shouldOpenImagePicker:f}):null)]})]})},Na=e=>{const{uri:a}=e,{data:i,loading:t,error:r}=(0,g.J)(p.n5.getPlaylists,[{uri:a}]),{public_playlists:o,total_public_playlists_count:s=0}=i||{};return t?(0,k.jsx)(c.h,{hasError:null!==r,errorMessage:d.ag.get("error.not_found.title.page")}):(0,k.jsx)(m.P,{className:n()("contentSpacing",f),total:s,title:d.ag.get("public_playlists"),showAll:!0,children:o?.map(((e,a)=>(0,k.jsx)(S.Z,{index:a,uri:e.uri,name:e.name,authorName:e.owner_name,description:e.followers_count?d.ag.get("user.followers",e.followers_count):"",images:[{url:(0,Xe.p)({imageUriOrUrl:e.image_url}),width:300,height:300}]},e.uri)))})},wa=e=>{const{uri:a}=e,{data:i,loading:t,error:r}=(0,g.J)(p.n5.getRecentlyPlayedArtists,[{uri:a,limit:50}]),o=i?.artists;return t?(0,k.jsx)(c.h,{hasError:null!==r,errorMessage:d.ag.get("error.not_found.title.page")}):(0,k.jsx)(m.P,{className:n()("contentSpacing",f),total:o?.length,title:d.ag.get("recently_played_artists"),showAll:!0,children:o?.map(((e,a)=>(0,k.jsx)(P.I,{index:a,name:e.name,uri:e.uri,images:[{url:e.image_url}]},e.uri)))})},Pa=()=>{const{data:e,loading:a,error:i}=(0,g.J)(p.n5.getUserTopArtists),t=e?.body;return a?(0,k.jsx)(c.h,{hasError:null!==i,errorMessage:d.ag.get("error.not_found.title.page")}):t?(0,k.jsx)(m.P,{className:n()("contentSpacing",f),total:t.items.length,title:d.ag.get("top_artists_this_month"),tagline:d.ag.get("only_visible_to_you"),showAll:!0,children:t.items.map(((e,a)=>(0,k.jsx)(P.I,{index:a,uri:e.uri,name:e.name,images:e.images},e.uri)))}):null},Sa=({uri:e})=>{const{data:a,loading:i,error:t}=(0,g.J)(p.n5.getProfile,[{uri:e}]);return a&&!i&&(a?.is_current_user||!1)?(0,k.jsx)(Pa,{}):(0,k.jsx)(c.h,{hasError:null!==t,errorMessage:d.ag.get("error.not_found.title.page")})},Ca=({uri:e})=>{const{data:a,loading:i,error:t}=(0,g.J)(p.n5.getUserTopTracks,[{offset:0,limit:50}]),r=a?.body;return i?(0,k.jsx)(c.h,{hasError:null!==t,errorMessage:d.ag.get("error.not_found.title.page")}):r?(0,k.jsxs)("div",{className:n()("contentSpacing",f,x),children:[(0,k.jsxs)("div",{className:b,children:[(0,k.jsx)(U.D,{as:"h1",variant:"canon",className:y,children:d.ag.get("top_tracks_this_month")}),(0,k.jsx)(U.D,{as:"p",variant:"mesto",children:d.ag.get("only_visible_to_you")})]}),(0,k.jsx)(pa,{tracks:r.items,uri:e,hasHeaderRow:!0})]}):null},Ra=({uri:e})=>{const{data:a,loading:i,error:t}=(0,g.J)(p.n5.getProfile,[{uri:e}]);return a&&!i&&(a?.is_current_user||!1)?(0,k.jsx)(Ca,{uri:e}):(0,k.jsx)(c.h,{hasError:null!==t,errorMessage:d.ag.get("error.not_found.title.page")})};var Ta=i(184);const Oa=(0,t.memo)((function(){const{userId:e=""}=(0,r.UO)(),a=decodeURIComponent(e),i=(0,s.QK)(a).toURI();return(0,k.jsx)("section",{children:(0,k.jsxs)(r.Z5,{children:[(0,k.jsx)(r.AW,{path:"playlists",element:(0,k.jsx)(Ta.K,{pageId:o.Wg.PROFILE_PLAYLISTS,children:(0,k.jsx)(Na,{uri:i})})}),(0,k.jsx)(r.AW,{path:"top/tracks",element:(0,k.jsx)(Ta.K,{pageId:o.Wg.PROFILE_TOP_TRACKS,children:(0,k.jsx)(Ra,{uri:i})})}),(0,k.jsx)(r.AW,{path:"top/artists",element:(0,k.jsx)(Ta.K,{pageId:o.Wg.PROFILE_TOP_ARTISTS,children:(0,k.jsx)(Sa,{uri:i})})}),(0,k.jsx)(r.AW,{path:"recently-played-artists",element:(0,k.jsx)(Ta.K,{pageId:o.Wg.PROFILE_RECENTLY_PLAYED_ARTISTS,children:(0,k.jsx)(wa,{uri:i})})}),(0,k.jsx)(r.AW,{path:"following",element:(0,k.jsx)(Ta.K,{pageId:o.Wg.PROFILE_FOLLOWING,children:(0,k.jsx)(I,{uri:i})})}),(0,k.jsx)(r.AW,{path:"followers",element:(0,k.jsx)(Ta.K,{pageId:o.Wg.PROFILE_FOLLOWERS,children:(0,k.jsx)(j,{uri:i})})}),(0,k.jsx)(r.AW,{path:"/",element:(0,k.jsx)(Ta.K,{pageId:o.Wg.PROFILE,children:(0,k.jsx)(_a,{uri:i})})})]})})}))},97428:(e,a,i)=>{i.d(a,{$:()=>t});const t=e=>e?.linked_from?.uri||e.uri}}]);
//# sourceMappingURL=xpui-routes-profile.js.map